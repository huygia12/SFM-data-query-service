generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Admin {
  adminId       String         @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  password      String
  username      String         @db.VarChar(255)
  email         String         @unique(map: "email_unique")
  refreshTokens String[]       @default([])
  createdAt     DateTime       @default(now()) @db.Timestamptz(6)
  deletedAt     DateTime?      @db.Timestamptz(6)
  PersonalForm  PersonalForm[]
}

model Category {
  categoryId   String         @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  title        String
  PersonalForm PersonalForm[]
}

model PersonalForm {
  personalFormId String     @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  signature      String?
  studentId      String     @db.Uuid
  categoryId     String     @db.Uuid
  updatedBy      String?    @db.Uuid
  createdAt      DateTime   @default(now()) @db.Timestamptz(6)
  deletedAt      DateTime?  @db.Timestamptz(6)
  status         FormStatus @default(STAGING)
  data           String
  Admin          Admin?     @relation(fields: [updatedBy], references: [adminId], onDelete: NoAction, onUpdate: NoAction, map: "PersonalForm_approvedBy_fkey")
  category       Category   @relation(fields: [categoryId], references: [categoryId], onDelete: NoAction, onUpdate: NoAction)
  student        Student    @relation(fields: [studentId], references: [studentId], onDelete: NoAction, onUpdate: NoAction)
}

model Student {
  studentId        String         @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  password         String
  username         String         @db.VarChar(255)
  refreshTokens    String[]       @default([])
  createdAt        DateTime       @default(now()) @db.Timestamptz(6)
  deletedAt        DateTime?      @db.Timestamptz(6)
  studentCode      String         @unique(map: "studentcode_unique")
  gender           Int
  birthPlace       String?
  phoneNumber      String?
  class            String?
  email            String         @unique(map: "uq_student_email")
  lockStatus       Boolean        @default(false)
  private_key      String
  hash_email       String?
  hash_studentCode String?
  loginAttemps     Int            @default(0)
  personalForms    PersonalForm[]
}

model OTP {
  Id               String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  type             Int?
  otpHash          String?
  expireAt         DateTime? @db.Timestamptz(6)
  validateAttempts Int       @default(0)
  createdAt        DateTime  @default(now()) @db.Timestamptz(6)
  email            String    @db.VarChar(100)
}

enum FieldType {
  OCR_WORD
  OCR_CHAR
  CHECK_BOX
}

enum Gender {
  MALE
  FEMALE
}

enum FormStatus {
  APPROVED
  DENIED
  STAGING
}
